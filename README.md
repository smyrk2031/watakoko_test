# アプリ名
    - 私はここにいる！

# アプリ概要
    - クライアントのGPS情報から、いまいる建物と部屋の名前をレコメンド
    - クライアントが選択した建物・部屋を登録する
    (登録：まずはキャッシュに保持のみ。将来的には外部へfetchしSQL-DBへinsertする)

# 想定のクライアント
## デバイス
    - iPhone SE2
    - Android Google Pixel 4a
    - パソコン（パソコンからのアクセスを許すかどうか切替えたい）
## ブラウザアプリ
    - Edge
    - Chrome
    - safari

# 技術選定
    - HTML
    - vanira_css
    - javascript
    ※フレームワークは用いず、フロントエンドで完結する仕組みにする
    - 地図はMapLibre GL JSを使用
    　（後からデザインのカスタマイズがしやすいようにファイル配置する）

# バックエンド処理のポイント
    1. GPSから、どの建物のどの階層のどの部屋かをレコメンドする機能
        - 外部jsonファイル(building_info.json)を参照する事で、建物情報の追加を容易に。
            - jsonのポイント
                - 建物名ごとに、建物座標を設定
                    （緯度経度を3箇所以上登録でき、この座標を頂点とした時に、その範囲が建物範囲という定義をする）
                - 建物ごとに階層数を指定し建物ごとに階層（B1, 1F, 2Fなど自由に）を設定
　　　　        - 建物の階層ごとに、部屋の範囲座標を設定
                    （緯度経度を3箇所以上登録でき、この座標を頂点とした時に、その範囲が部屋範囲という定義をする）
            - building_info.jsonフォーマット: 
            {
                "buildings": [
                    {
                        "id": "building_a",
                        "name_ja": "A棟",
                        "name_en": "Building A",
                        "polygon": [
                            { "lat": 35.689501, "lng": 139.691745 },
                            { "lat": 35.689610, "lng": 139.692050 },
                            { "lat": 35.689350, "lng": 139.692150 }
                        ],
                        "description": "メインオフィス棟",
                        "floors": [
                            {
                                "label": "1F",
                                "rooms": [
                                    {
                                        "id": "room_101",
                                        "name_ja": "会議室101",
                                        "name_en": "Meeting Room 101",
                                        "usage": "会議室",
                                        "access": {
                                            "open": "09:00",
                                            "close": "18:00"
                                        },
                                        "imageUrl": "images/room101.png",
                                        "polygon": [
                                            { "lat": 35.689510, "lng": 139.691800 },
                                            { "lat": 35.689510, "lng": 139.691900 },
                                            { "lat": 35.689400, "lng": 139.691900 },
                                            { "lat": 35.689400, "lng": 139.691800 }
                                        ]
                                    },
                                    {
                                        "id": "room_102",
                                        "name_ja": "休憩室102",
                                        "name_en": "Lounge 102",
                                        "usage": "休憩室",
                                        "imageUrl": "images/room102.png",
                                        "polygon": [
                                            { "lat": 35.689400, "lng": 139.691800 },
                                            { "lat": 35.689400, "lng": 139.691900 },
                                            { "lat": 35.689300, "lng": 139.691900 },
                                            { "lat": 35.689300, "lng": 139.691800 }
                                        ]
                                    }
                                ]
                            },
                            {
                                "label": "2F",
                                "rooms": []
                            }
                        ]
                    }
                ]
            }
            - 項目説明
                - 項目	型	説明
                    buildings	Array	複数の建物情報を保持する配列。
                    id	String	建物の一意なID。部屋の位置特定などで使用。
                    name_ja, name_en	String	建物名（日本語・英語など多言語対応）。
                    polygon	Array<Object>	建物を囲むポリゴン（緯度経度リスト）。位置判定に使用。
                    description	String	建物の概要説明（任意）。
                    floors	Array	階層リスト。自由なラベルでOK（"B1", "RF"など）。
                    floors.label	String	階層名（UI上の表示ラベル）。
                    rooms	Array	各階層内の部屋一覧。
                    rooms.id	String	各部屋の一意な識別子。
                    name_ja, name_en	String	部屋名（多言語対応）。
                    usage	String	部屋の用途（会議室・ラウンジなど）。
                    access	Object	入室可能な時間帯など（将来的にアクセス制限などにも利用可）。
                    imageUrl	String	部屋の図面や写真のURL（任意）。
                    polygon	Array<Object>	部屋を囲むポリゴン（緯度経度リスト）。GPS判定に使用。

        2. 「みんどこ？」機能
            - 外部jsonファイルのmembers_loc.json（将来的にはSQL-db）からほかの人の登録位置を取得して、マップに表示する機能
            - members_loc.jsonのフォーマット
            -   {
                    "members": [
                        {
                        "id": "user_001",
                        "username": "たかし",
                        "iconUrl": "icons/takashi.png",
                        "groups": ["営業部", "A棟ユーザー"],
                        "status": "在席",  // "在席" / "離席" / "移動中" / "退室済" など
                        "location": {
                            "timestamp": "2025-07-26T08:40:00Z",
                            "building_id": "building_a",
                            "floor_label": "1F",
                            "room_id": "room_101",
                            "coordinates": {
                            "lat": 35.689455,
                            "lng": 139.691845
                            },
                            "display_offset": {
                            "x": 5,
                            "y": -8
                            }
                        },
                        "note": "会議中"
                        }
                    ]
                    }

            - 項目説明
                項目	型	説明
                members	Array	ユーザーの位置情報一覧。
                id	String	ユーザーの一意な識別子。ログインIDなどに対応。
                username	String	表示名（UI上に表示する名前）。
                iconUrl	String	ユーザーアイコン画像のURL。地図上ピンや詳細表示で使用。
                groups	Array<String>	所属グループ（複数可）。表示フィルタなどに使用。
                status	String	ユーザー状態。例: "在席", "離席", "移動中", "退室済" など。ピンの色分けに使用。
                location.timestamp	String(ISO8601)	最終登録時刻。表示の鮮度判定に使用。
                location.building_id	String	所在地の建物ID（building_info.jsonとリンク）。
                location.floor_label	String	所在地の階層ラベル（例: "1F", "B1"）。
                location.room_id	String	所在地の部屋ID（building_info.jsonとリンク）。
                location.coordinates	Object	部屋内の表示中心位置（緯度・経度）。部屋の中心など。
                location.display_offset	Object	ピンの表示位置をずらすためのX,Yオフセット（px単位）。重なり回避用。
                note	String	任意メモ（用途や一言コメントなど）。ポップアップ表示時に使用。




# UI(クライアントがへ知らせる表示や、操作する画面のボタン)
## 画面について
### 画面構成
    - ユーザ設定画面
    - メイン画面
    - マップ画面
    - ハンバーガメニューボタン連携した左側のサイドバー

### 各画面の詳細仕様
#### ユーザ設定画面
    - 設定した情報はブラウザのキャッシュで保持する
    - キャッシュにユーザIDが未設定の場合は、ユーザ設定画面から始まること
    - <ユーザ名>
        - 最大文字数：20文字
        - 半角・全角の英数字、記号、ひらがな、カタカナ、漢字を許容
    - <ID>7桁数字
        - 数字しか入力できないように
        - 7文字未満は許容しない。必ず7文字。
        - 入力のキーボードも自動で数字に切り替わり、UXが高いデザインに。
    - <グループ>グループ名の表示
    - <アイコン>GPS位置のピンに表示するアイコン画像
        - 画像ファイルをドラッグ&ドロップか、ファイル選択ダイアログで1ファイル指定
        - jpg, png, icoを許容
    
#### メイン画面
    - キャッシュにユーザIDが設定済の場合は、メイン画面から始まる
    - [ボタン]私はここにいる！
        - 押下でGPSを取得
        - GPS位置をもとに建物名を表示
        - [階層一覧表示]その建物の階層をユーザがタップで選ぶ（プルダウンよりは一覧で階層選択肢を出した方が1手間減らせる）
        - [近傍部屋一覧表示]選ばれた階層から、GPS座標の半径50m範囲内の部屋を近傍順で並べて表示し、ユーザが自分のいる部屋を選ぶ
        - 選ばれた建物と部屋を登録  (登録：まずはキャッシュに保持のみ。将来的には外部へfetchしSQL-DBへinsertする)
    - [画面下部にマップ]
        - マップの初期表示位置は名古屋駅が中心
        - ユーザが部屋選択したら、GPU位置（緑）と選択した部屋の真ん中（青）の両方にピンを立てて！（デバッグ用、精度ずれ視認用）
            - ピンは円からとんがりが出ているスタイル
                - 円の中には設定されているアイコン
                - デフォルトは任せます
        - [マップの建物範囲表示/非表示切替えボタン（矢印的なアイコンだと切替え感が出るかも）]
            - 表示を押すと、jsonに準備されている全建物のそれぞれの範囲を半透明で10色くらい使ってここが分かれる用に表示する
            - 非表示を押すと、通常のマップに戻る
        - [みんどこ？]ボタン：自分の位置だけを表示するモードと、members.jsonに登録されているメンバを表示するのを切り替える
            - メンバ表示時
                - メンバーにはグループ名を複数を登録できるようにして、
                　グループでフィルタしてマップ表示できるようにしたい。もちろん全表示もあり。
                - 登録時刻が1時間以内の情報はくっきりとピンで表示、1日以内の情報は目印付きのピンに、
                　1日以上古い情報は半透明にするなど分けられるといいと思う。
                - マップの拡大率次第ではアイコン付きのメンバーのピンが大量についてよくわからなくなるので、
                　十分にアイコンを差別化して視認できないズーム率の時はそこの建物や部屋に何人いるかの数を表示するのでいい。
                - メンバーのアイコンとピンは、基本的に部屋の中央座標が入っているので一致してしまう。
                　表示する時にすでにある場合は重ならないようにランダムの方向によけて表示してほしい。
                - メンバーのアイコンはマウスホバーもしくは1タップすると詳細小窓が開き
                　そのメンバーのユーザ名とアイコンが表示されてほしい。
